<?php
defined('BASEPATH') OR exit('');

/**
 * Description of Customer
 *
 * @author Tavonga <mafuratavonga@gmail.com>
 * @date 15th Jan, 2023
 */
class Category extends CI_Model{
    public function __construct(){
        parent::__construct();
    }
    
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    public function getAll($orderBy, $orderFormat, $start=0, $limit=''){
        $this->db->limit($limit, $start);
        $this->db->order_by($orderBy, $orderFormat);
        
        $run_q = $this->db->get('categories');
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }


    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function getbid($categorie) {
        $this->db->select('percentage');
        $this->db->where('id', $categorie);
        $query = $this->db->get('categories');
        
        if ($query->num_rows() > 0) {
            $row = $query->row();
            return $row->percentage;
        } else {
            return false;
        }
    }
    
    

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */


    public function getCat() {
        $run_q = $this->db->get('categories');
        
        if ($run_q->num_rows() > 0) {
            return $run_q->result();
        } else {
            return FALSE;
        }
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    
    /**
     * 
     * @param type $categorieName
     * @param type $categoriestatus
     * @param type $categoriepercentage
     * @return boolean
     */
    public function add($categorieName, $categoriestatus, $categoriepercentage){
        $data = ['name'=>$categorieName, 'status'=>$categoriestatus, 'percentage'=>$categoriepercentage];

        $this->db->insert('categories', $data);
        
        if($this->db->insert_id()){
            return $this->db->insert_id();
        }
        
        else{
            return FALSE;
        }
    }
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    /**
     * 
     * @param type $value
     * @return boolean
     */
    

     public function categoriesearch($value){
        $q = "SELECT * FROM categories 
            WHERE 
            name LIKE '%".$this->db->escape_like_str($value)."%'";
          
        $run_q = $this->db->query($q);
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }    
      
    
    


   /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
   
   /**
    * 
    * @param type $categorieid
    * @param type $categorieName
    * @param type $categorieStatus
    * @param type $categoriePercentage
    */
   public function edit($categorieid, $categorieName, $categorieStatus, $categoriePercentage){
       $data = ['name'=>$categorieName, 'status'=>$categorieStatus, 'percentage'=>$categoriePercentage];
       
       $this->db->where('id', $categorieid);
       $this->db->update('categories', $data);
       
       return TRUE;
   }
   
   /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
   
	public function getActiveCategories($orderBy, $orderFormat){
        $this->db->order_by($orderBy, $orderFormat);
        
        $this->db->where('quantity', 1);
        
        $run_q = $this->db->get('categories');
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }
    


    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    /**
     * array $where_clause
     * array $fields_to_fetch
     * 
     * return array | FALSE
     */
    public function getCategorieInfo($where_clause, $fields_to_fetch){
        $this->db->select($fields_to_fetch);
        
        $this->db->where($where_clause);

        $run_q = $this->db->get('categories');
        
        return $run_q->num_rows() ? $run_q->row() : FALSE;
    }
    
}